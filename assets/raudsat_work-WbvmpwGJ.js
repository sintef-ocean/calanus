var Ie=Object.defineProperty;var Jt=t=>{throw TypeError(t)};var Re=(t,e,r)=>e in t?Ie(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var w=(t,e,r)=>Re(t,typeof e!="symbol"?e+"":e,r),gt=(t,e,r)=>e.has(t)||Jt("Cannot "+r);var _=(t,e,r)=>(gt(t,e,"read from private field"),r?r.call(t):e.get(t)),E=(t,e,r)=>e.has(t)?Jt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),k=(t,e,r,n)=>(gt(t,e,"write to private field"),n?n.call(t,r):e.set(t,r),r),bt=(t,e,r)=>(gt(t,e,"access private method"),r);/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const pe=Symbol("Comlink.proxy"),Oe=Symbol("Comlink.endpoint"),Le=Symbol("Comlink.releaseProxy"),mt=Symbol("Comlink.finalizer"),ot=Symbol("Comlink.thrown"),ye=t=>typeof t=="object"&&t!==null||typeof t=="function",Fe={canHandle:t=>ye(t)&&t[pe],serialize(t){const{port1:e,port2:r}=new MessageChannel;return jt(t,e),[r,[r]]},deserialize(t){return t.start(),ze(t)}},Ue={canHandle:t=>ye(t)&&ot in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},_e=new Map([["proxy",Fe],["throw",Ue]]);function Pe(t,e){for(const r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function jt(t,e=globalThis,r=["*"]){e.addEventListener("message",function n(s){if(!s||!s.data)return;if(!Pe(r,s.origin)){console.warn("Invalid origin '".concat(s.origin,"' for comlink proxy"));return}const{id:a,type:o,path:l}=Object.assign({path:[]},s.data),f=(s.data.argumentList||[]).map(j);let c;try{const i=l.slice(0,-1).reduce((d,h)=>d[h],t),u=l.reduce((d,h)=>d[h],t);switch(o){case"GET":c=u;break;case"SET":i[l.slice(-1)[0]]=j(s.data.value),c=!0;break;case"APPLY":c=u.apply(i,f);break;case"CONSTRUCT":{const d=new u(...f);c=Ve(d)}break;case"ENDPOINT":{const{port1:d,port2:h}=new MessageChannel;jt(t,h),c=et(d,[d])}break;case"RELEASE":c=void 0;break;default:return}}catch(i){c={value:i,[ot]:0}}Promise.resolve(c).catch(i=>({value:i,[ot]:0})).then(i=>{const[u,d]=lt(i);e.postMessage(Object.assign(Object.assign({},u),{id:a}),d),o==="RELEASE"&&(e.removeEventListener("message",n),ge(e),mt in t&&typeof t[mt]=="function"&&t[mt]())}).catch(i=>{const[u,d]=lt({value:new TypeError("Unserializable return value"),[ot]:0});e.postMessage(Object.assign(Object.assign({},u),{id:a}),d)})}),e.start&&e.start()}function Be(t){return t.constructor.name==="MessagePort"}function ge(t){Be(t)&&t.close()}function ze(t,e){const r=new Map;return t.addEventListener("message",function(s){const{data:a}=s;if(!a||!a.id)return;const o=r.get(a.id);if(o)try{o(a)}finally{r.delete(a.id)}}),Et(t,r,[],e)}function at(t){if(t)throw new Error("Proxy has been released and is not useable")}function be(t){return F(t,new Map,{type:"RELEASE"}).then(()=>{ge(t)})}const ct=new WeakMap,ft="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(ct.get(t)||0)-1;ct.set(t,e),e===0&&be(t)});function $e(t,e){const r=(ct.get(e)||0)+1;ct.set(e,r),ft&&ft.register(t,e,t)}function De(t){ft&&ft.unregister(t)}function Et(t,e,r=[],n=function(){}){let s=!1;const a=new Proxy(n,{get(o,l){if(at(s),l===Le)return()=>{De(a),be(t),e.clear(),s=!0};if(l==="then"){if(r.length===0)return{then:()=>a};const f=F(t,e,{type:"GET",path:r.map(c=>c.toString())}).then(j);return f.then.bind(f)}return Et(t,e,[...r,l])},set(o,l,f){at(s);const[c,i]=lt(f);return F(t,e,{type:"SET",path:[...r,l].map(u=>u.toString()),value:c},i).then(j)},apply(o,l,f){at(s);const c=r[r.length-1];if(c===Oe)return F(t,e,{type:"ENDPOINT"}).then(j);if(c==="bind")return Et(t,e,r.slice(0,-1));const[i,u]=Gt(f);return F(t,e,{type:"APPLY",path:r.map(d=>d.toString()),argumentList:i},u).then(j)},construct(o,l){at(s);const[f,c]=Gt(l);return F(t,e,{type:"CONSTRUCT",path:r.map(i=>i.toString()),argumentList:f},c).then(j)}});return $e(a,t),a}function We(t){return Array.prototype.concat.apply([],t)}function Gt(t){const e=t.map(lt);return[e.map(r=>r[0]),We(e.map(r=>r[1]))]}const me=new WeakMap;function et(t,e){return me.set(t,e),t}function Ve(t){return Object.assign(t,{[pe]:!0})}function lt(t){for(const[e,r]of _e)if(r.canHandle(t)){const[n,s]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},s]}return[{type:"RAW",value:t},me.get(t)||[]]}function j(t){switch(t.type){case"HANDLER":return _e.get(t.name).deserialize(t.value);case"RAW":return t.value}}function F(t,e,r,n){return new Promise(s=>{const a=Ye();e.set(a,s),t.start&&t.start(),t.postMessage(Object.assign({id:a},r),n)})}function Ye(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}class rt extends Error{constructor(e,r={}){super("Node not found: ".concat(e),r),this.name="NodeNotFoundError"}}class It extends Error{constructor(e){super("Missing key: ".concat(e)),this.name="KeyError"}}var C;class we{constructor(e,r,n){E(this,C);typeof e=="number"?k(this,C,new Uint8Array(e)):e instanceof ArrayBuffer?k(this,C,new Uint8Array(e,r,n)):k(this,C,new Uint8Array(Array.from(e,s=>s?1:0)))}get BYTES_PER_ELEMENT(){return 1}get byteOffset(){return _(this,C).byteOffset}get byteLength(){return _(this,C).byteLength}get buffer(){return _(this,C).buffer}get length(){return _(this,C).length}get(e){let r=_(this,C)[e];return typeof r=="number"?r!==0:r}set(e,r){_(this,C)[e]=r?1:0}fill(e){_(this,C).fill(e?1:0)}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.get(e)}}C=new WeakMap;var U;class Rt{constructor(e,r,n,s){w(this,"_data");w(this,"chars");E(this,U);if(this.chars=e,k(this,U,new TextEncoder),typeof r=="number")this._data=new Uint8Array(r*e);else if(r instanceof ArrayBuffer)s&&(s=s*e),this._data=new Uint8Array(r,n,s);else{let a=Array.from(r);this._data=new Uint8Array(a.length*e);for(let o=0;o<a.length;o++)this.set(o,a[o])}}get BYTES_PER_ELEMENT(){return this.chars}get byteOffset(){return this._data.byteOffset}get byteLength(){return this._data.byteLength}get buffer(){return this._data.buffer}get length(){return this.byteLength/this.BYTES_PER_ELEMENT}get(e){const r=new Uint8Array(this.buffer,this.byteOffset+this.chars*e,this.chars);return new TextDecoder().decode(r).replace(/\x00/g,"")}set(e,r){const n=new Uint8Array(this.buffer,this.byteOffset+this.chars*e,this.chars);n.fill(0),n.set(_(this,U).encode(r))}fill(e){const r=_(this,U).encode(e);for(let n=0;n<this.length;n++)this._data.set(r,n*this.chars)}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.get(e)}}U=new WeakMap;var x;const $t=class $t{constructor(e,r,n,s){E(this,x);w(this,"chars");if(this.chars=e,typeof r=="number")k(this,x,new Int32Array(r*e));else if(r instanceof ArrayBuffer)s&&(s*=e),k(this,x,new Int32Array(r,n,s));else{const a=r,o=new $t(e,1);k(this,x,new Int32Array(function*(){for(let l of a)o.set(0,l),yield*_(o,x)}()))}}get BYTES_PER_ELEMENT(){return _(this,x).BYTES_PER_ELEMENT*this.chars}get byteLength(){return _(this,x).byteLength}get byteOffset(){return _(this,x).byteOffset}get buffer(){return _(this,x).buffer}get length(){return _(this,x).length/this.chars}get(e){const r=this.chars*e;let n="";for(let s=0;s<this.chars;s++)n+=String.fromCodePoint(_(this,x)[r+s]);return n.replace(/\u0000/g,"")}set(e,r){var a;const n=this.chars*e,s=_(this,x).subarray(n,n+this.chars);s.fill(0);for(let o=0;o<this.chars;o++)s[o]=(a=r.codePointAt(o))!=null?a:0}fill(e){this.set(0,e);let r=_(this,x).subarray(0,this.chars);for(let n=1;n<this.length;n++)_(this,x).set(r,n*this.chars)}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.get(e)}};x=new WeakMap;let D=$t;function nt(t){const e=new TextDecoder().decode(t);return JSON.parse(e)}function qt(t,e){const r=e/2,n=e-1;let s=0;for(let a=0;a<t.length;a+=e)for(let o=0;o<r;o+=1)s=t[a+o],t[a+o]=t[a+n-o],t[a+n-o]=s}function Ae(t){if(t==="v2:object")return globalThis.Array;let e=t.match(/v2:([US])(\d+)/);if(e){let[,n,s]=e;return(n==="U"?D:Rt).bind(null,Number(s))}let r={int8:Int8Array,int16:Int16Array,int32:Int32Array,int64:globalThis.BigInt64Array,uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array,uint64:globalThis.BigUint64Array,float16:globalThis.Float16Array,float32:Float32Array,float64:Float64Array,bool:we}[t];return T(r,"Unknown or unsupported data_type: ".concat(t)),r}function R(t,e){const r=t.length;typeof e=="string"&&(e=e==="C"?Array.from({length:r},(a,o)=>o):Array.from({length:r},(a,o)=>r-1-o)),T(r===e.length,"Order length must match the number of dimensions.");let n=1,s=new Array(r);for(let a=e.length-1;a>=0;a--)s[e[a]]=n,n*=t[e[a]];return s}function He({name:t,configuration:e}){var r,n;if(t==="default"){const s=(r=e==null?void 0:e.separator)!=null?r:"/";return a=>["c",...a].join(s)}if(t==="v2"){const s=(n=e==null?void 0:e.separator)!=null?n:".";return a=>a.join(s)||"0"}throw new Error("Unknown chunk key encoding: ".concat(t))}function Je(t){var a;if(t==="|O")return{data_type:"v2:object"};let e=t.match(/^([<|>])(.*)$/);T(e,"Invalid dtype: ".concat(t));let[,r,n]=e,s=(a={b1:"bool",i1:"int8",u1:"uint8",i2:"int16",u2:"uint16",i4:"int32",u4:"uint32",i8:"int64",u8:"uint64",f2:"float16",f4:"float32",f8:"float64"}[n])!=null?a:n.startsWith("S")||n.startsWith("U")?"v2:".concat(n):void 0;return T(s,"Unsupported or unknown dtype: ".concat(t)),r==="|"?{data_type:s}:{data_type:s,endian:r==="<"?"little":"big"}}function Ge(t,e={}){var s,a;let r=[],n=Je(t.dtype);t.order==="F"&&r.push({name:"transpose",configuration:{order:"F"}}),"endian"in n&&n.endian==="big"&&r.push({name:"bytes",configuration:{endian:"big"}});for(let{id:o,...l}of(s=t.filters)!=null?s:[])r.push({name:o,configuration:l});if(t.compressor){let{id:o,...l}=t.compressor;r.push({name:o,configuration:l})}return{zarr_format:3,node_type:"array",shape:t.shape,data_type:n.data_type,chunk_grid:{name:"regular",configuration:{chunk_shape:t.chunks}},chunk_key_encoding:{name:"v2",configuration:{separator:(a=t.dimension_separator)!=null?a:"."}},codecs:r,fill_value:t.fill_value,attributes:e}}function qe(t,e={}){return{zarr_format:3,node_type:"group",attributes:e}}function Ke(t,e){if(e!=="number"&&e!=="bigint"&&e!=="boolean"&&e!=="object"&&e!=="string")return t===e;let r=t==="bool";if(e==="boolean")return r;let n=t.startsWith("v2:U")||t.startsWith("v2:S");if(e==="string")return n;let s=t==="int64"||t==="uint64";if(e==="bigint")return s;let a=t==="v2:object";return e==="object"?a:!n&&!s&&!r&&!a}function Xe(t){return(t==null?void 0:t.name)==="sharding_indexed"}function ve(t){return(t.data_type==="uint64"||t.data_type==="int64")&&t.fill_value!=null?BigInt(t.fill_value):t.fill_value}function ke(t,...e){if(!e.some(r=>t instanceof r))throw t}function T(t,e=""){if(!t)throw new Error(e)}async function Ee(t,{format:e,signal:r}){const n=t instanceof Response?t:new Response(t);T(n.body,"Response does not contain body.");try{return await new Response(n.body.pipeThrough(new DecompressionStream(e),{signal:r})).arrayBuffer()}catch(s){throw r==null||r.throwIfAborted(),new Error("Failed to decode ".concat(e))}}class Ot{constructor(e,r){w(this,"kind","array_to_array");T(e.keepbits>=0,"keepbits must be zero or positive")}static fromConfig(e,r){return new Ot(e,r)}encode(e){throw new Error("`BitroundCodec.encode` is not implemented. Please open an issue at https://github.com/manzt/zarrita.js/issues.")}decode(e){return e}}const Kt=Qe();function Qe(){const t=new Uint32Array([305419896]);return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)[0]!==18}function Xt(t){return"BYTES_PER_ELEMENT"in t?t.BYTES_PER_ELEMENT:4}var W,S,V,Y,P;const Dt=class Dt{constructor(e,r){w(this,"kind","array_to_bytes");E(this,W);E(this,S);E(this,V);E(this,Y);E(this,P);k(this,P,e==null?void 0:e.endian),k(this,S,Ae(r.data_type)),k(this,Y,r.shape),k(this,W,R(r.shape,"C"));const n=new(_(this,S))(0);k(this,V,n.BYTES_PER_ELEMENT)}static fromConfig(e,r){return new Dt(e,r)}encode(e){let r=new Uint8Array(e.data.buffer);return Kt&&_(this,P)==="big"&&qt(r,Xt(_(this,S))),r}decode(e){return Kt&&_(this,P)==="big"&&qt(e,Xt(_(this,S))),{data:new(_(this,S))(e.buffer,e.byteOffset,e.byteLength/_(this,V)),shape:_(this,Y),stride:_(this,W)}}};W=new WeakMap,S=new WeakMap,V=new WeakMap,Y=new WeakMap,P=new WeakMap;let ht=Dt;class Lt{constructor(){w(this,"kind","bytes_to_bytes")}static fromConfig(){return new Lt}encode(e){throw new Error("Not implemented")}decode(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength-4)}}class Ft{constructor(){w(this,"kind","bytes_to_bytes")}static fromConfig(e){return new Ft}encode(e){throw new Error("Gzip encoding is not enabled by default. Please register a custom codec with `numcodecs/gzip`.")}async decode(e){const r=await Ee(e,{format:"gzip"});return new Uint8Array(r)}}function Ze(t,e){return T(!Number.isNaN(e),"JsonCodec allow_nan is false but NaN was encountered during encoding."),T(e!==Number.POSITIVE_INFINITY,"JsonCodec allow_nan is false but Infinity was encountered during encoding."),T(e!==Number.NEGATIVE_INFINITY,"JsonCodec allow_nan is false but -Infinity was encountered during encoding."),e}function tr(t,e){return e instanceof Object&&!Array.isArray(e)?Object.keys(e).sort().reduce((r,n)=>(r[n]=e[n],r),{}):e}var H,J;const Wt=class Wt{constructor(e={}){w(this,"configuration");w(this,"kind","array_to_bytes");E(this,H);E(this,J);this.configuration=e;const{encoding:r="utf-8",skipkeys:n=!1,ensure_ascii:s=!0,check_circular:a=!0,allow_nan:o=!0,sort_keys:l=!0,indent:f,strict:c=!0}=e;let i=e.separators;i||(f?i=[", ",": "]:i=[",",":"]),k(this,H,{encoding:r,skipkeys:n,ensure_ascii:s,check_circular:a,allow_nan:o,indent:f,separators:i,sort_keys:l}),k(this,J,{strict:c})}static fromConfig(e){return new Wt(e)}encode(e){const{indent:r,encoding:n,ensure_ascii:s,check_circular:a,allow_nan:o,sort_keys:l}=_(this,H);T(n==="utf-8","JsonCodec does not yet support non-utf-8 encoding.");const f=[];T(a,"JsonCodec does not yet support skipping the check for circular references during encoding."),o||f.push(Ze),l&&f.push(tr);const c=Array.from(e.data);c.push("|O"),c.push(e.shape);let i;f.length&&(i=(d,h)=>{let p=h;for(let g of f)p=g(d,p);return p});let u=JSON.stringify(c,i,r);return s&&(u=u.replace(/[\u007F-\uFFFF]/g,d=>{const h="0000".concat(d.charCodeAt(0).toString(16)),p=h.substring(h.length-4);return"\\u".concat(p)})),new TextEncoder().encode(u)}decode(e){const{strict:r}=_(this,J);T(r,"JsonCodec does not yet support non-strict decoding.");const n=nt(e),s=n.pop();n.pop(),T(s,"0D not implemented for JsonCodec.");const a=R(s,"C");return{data:n,shape:s,stride:a}}};H=new WeakMap,J=new WeakMap;let Tt=Wt;function Qt(t){return t instanceof we||t instanceof Rt||t instanceof D?new Proxy(t,{get(r,n){return r.get(Number(n))},set(r,n,s){return r.set(Number(n),s),!0}}):t}function er(t,e){let r;return t.data instanceof Rt||t.data instanceof D?r=new t.constructor(t.data.length,t.data.chars):r=new t.constructor(t.data.length),{data:r,shape:t.shape,stride:R(t.shape,e)}}function rr(t,e){let r=er(t,e),n=t.shape.length,s=t.data.length,a=Array(n).fill(0),o=Qt(t.data),l=Qt(r.data);for(let f=0;f<s;f++){let c=0;for(let i=0;i<n;i++)c+=a[i]*r.stride[i];l[c]=o[f],a[0]+=1;for(let i=0;i<n;i++)if(a[i]===t.shape[i]){if(i+1===n)break;a[i]=0,a[i+1]+=1}}return r}function nr(t){let e=t.shape.length;return T(e===t.stride.length,"Shape and stride must have the same length."),t.stride.map((r,n)=>({stride:r,index:n})).sort((r,n)=>n.stride-r.stride).map(r=>r.index)}function sr(t,e){let r=nr(t);return T(r.length===e.length,"Orders must match"),r.every((n,s)=>n===e[s])}var G,B;const Vt=class Vt{constructor(e,r){w(this,"kind","array_to_array");E(this,G);E(this,B);var l;let n=(l=e.order)!=null?l:"C",s=r.shape.length,a=new Array(s),o=new Array(s);if(n==="C")for(let f=0;f<s;++f)a[f]=f,o[f]=f;else if(n==="F")for(let f=0;f<s;++f)a[f]=s-f-1,o[f]=s-f-1;else a=n,a.forEach((f,c)=>{T(o[f]===void 0,"Invalid permutation: ".concat(JSON.stringify(n))),o[f]=c});k(this,G,a),k(this,B,o)}static fromConfig(e,r){return new Vt(e,r)}encode(e){return sr(e,_(this,B))?e:rr(e,_(this,B))}decode(e){return{data:e.data,shape:e.shape,stride:R(e.shape,_(this,G))}}};G=new WeakMap,B=new WeakMap;let xt=Vt;var q,K;const Yt=class Yt{constructor(e){w(this,"kind","array_to_bytes");E(this,q);E(this,K);k(this,q,e),k(this,K,R(e,"C"))}static fromConfig(e,r){return new Yt(r.shape)}encode(e){throw new Error("Method not implemented.")}decode(e){let r=new TextDecoder,n=new DataView(e.buffer),s=Array(n.getUint32(0,!0)),a=4;for(let o=0;o<s.length;o++){let l=n.getUint32(a,!0);a+=4,s[o]=r.decode(e.buffer.slice(a,a+l)),a+=l}return{data:s,shape:_(this,q),stride:_(this,K)}}};q=new WeakMap,K=new WeakMap;let Nt=Yt;class Ut{constructor(){w(this,"kind","bytes_to_bytes")}static fromConfig(e){return new Ut}encode(e){throw new Error("Zlib encoding is not enabled by default. Please register a codec with `numcodecs/zlib`.")}async decode(e){const r=await Ee(e,{format:"deflate"});return new Uint8Array(r)}}function ar(){return new Map().set("blosc",()=>import("./blosc-BjQ25la0.js").then(t=>t.default)).set("lz4",()=>import("./lz4-BTICsuZU.js").then(t=>t.default)).set("zstd",()=>import("./zstd-BM-Q2Kpi.js").then(t=>t.default)).set("gzip",()=>Ft).set("zlib",()=>Ut).set("transpose",()=>xt).set("bytes",()=>ht).set("crc32c",()=>Lt).set("vlen-utf8",()=>Nt).set("json2",()=>Tt).set("bitround",()=>Ot)}const ir=ar();function Ct(t){let e;return{async encode(r){e||(e=await Zt(t));for(const s of e.array_to_array)r=await s.encode(r);let n=await e.array_to_bytes.encode(r);for(const s of e.bytes_to_bytes)n=await s.encode(n);return n},async decode(r){e||(e=await Zt(t));for(let s=e.bytes_to_bytes.length-1;s>=0;s--)r=await e.bytes_to_bytes[s].decode(r);let n=await e.array_to_bytes.decode(r);for(let s=e.array_to_array.length-1;s>=0;s--)n=await e.array_to_array[s].decode(n);return n}}}async function Zt(t){let e=t.codecs.map(async a=>{var l;let o=await((l=ir.get(a.name))==null?void 0:l());return T(o,"Unknown codec: ".concat(a.name)),{Codec:o,meta:a}}),r=[],n,s=[];for await(let{Codec:a,meta:o}of e){let l=a.fromConfig(o.configuration,t);switch(l.kind){case"array_to_array":r.push(l);break;case"array_to_bytes":n=l;break;default:s.push(l)}}return n||(T(or(t),"Cannot encode ".concat(t.data_type," to bytes without a codec")),n=ht.fromConfig({endian:"little"},t)),{array_to_array:r,array_to_bytes:n,bytes_to_bytes:s}}function or(t){return t.data_type!=="v2:object"}const te=BigInt("18446744073709551615");function ur(t,e,r,n){T(t.store.getRange,"Store does not support range requests");let s=t.store.getRange.bind(t.store),a=e.map((f,c)=>f/n.chunk_shape[c]),o=Ct({data_type:"uint64",shape:[...a,2],codecs:n.index_codecs}),l={};return async f=>{let c=f.map((v,N)=>Math.floor(v/a[N])),i=t.resolve(r(c)).path,u;if(i in l)u=l[i];else{let v=4,N=16*a.reduce((b,st)=>b*st,1),L=await s(i,{suffixLength:N+v});u=l[i]=L?await o.decode(L):null}if(u===null)return;let{data:d,shape:h,stride:p}=u,g=f.map((v,N)=>v%h[N]).reduce((v,N,L)=>v+N*p[L],0),A=d[g],m=d[g+1];if(!(A===te&&m===te))return s(i,{offset:Number(A),length:Number(m)})}}class O{constructor(e,r="/"){w(this,"store");w(this,"path");this.store=e,this.path=r}resolve(e){let r=new URL("file://".concat(this.path.endsWith("/")?this.path:"".concat(this.path,"/")));return new O(this.store,new URL(e,r).pathname)}}function Te(t){return new O(t!=null?t:new Map)}var X;class Pt extends O{constructor(r,n,s){super(r,n);w(this,"kind","group");E(this,X);k(this,X,s)}get attrs(){return _(this,X).attributes}}X=new WeakMap;function ee(t){var r,n;const e=t.find(s=>s.name==="transpose");return(n=(r=e==null?void 0:e.configuration)==null?void 0:r.order)!=null?n:"C"}const $=Symbol("zarrita.context");function cr(t){return t[$]}function fr(t,e){var a;let{configuration:r}=(a=e.codecs.find(Xe))!=null?a:{},n={encode_chunk_key:He(e.chunk_key_encoding),TypedArray:Ae(e.data_type),fill_value:e.fill_value};if(r){let o=ee(r.codecs);return{...n,kind:"sharded",chunk_shape:r.chunk_shape,codec:Ct({data_type:e.data_type,shape:r.chunk_shape,codecs:r.codecs}),get_strides(l){return R(l,o)},get_chunk_bytes:ur(t,e.chunk_grid.configuration.chunk_shape,n.encode_chunk_key,r)}}let s=ee(e.codecs);return{...n,kind:"regular",chunk_shape:e.chunk_grid.configuration.chunk_shape,codec:Ct({data_type:e.data_type,shape:e.chunk_grid.configuration.chunk_shape,codecs:e.codecs}),get_strides(o){return R(o,s)},async get_chunk_bytes(o,l){let f=n.encode_chunk_key(o),c=t.resolve(f).path;return t.store.get(c,l)}}}var le,he,I,de;let dt=(de=class extends(he=O,le=$,he){constructor(r,n,s){super(r,n);w(this,"kind","array");E(this,I);w(this,le);k(this,I,{...s,fill_value:ve(s)}),this[$]=fr(this,s)}get attrs(){return _(this,I).attributes}get shape(){return _(this,I).shape}get chunks(){return this[$].chunk_shape}get dtype(){return _(this,I).data_type}async getChunk(r,n){let s=this[$],a=await s.get_chunk_bytes(r,n);if(!a){let o=s.chunk_shape.reduce((f,c)=>f*c,1),l=new s.TypedArray(o);return l.fill(s.fill_value),{data:l,shape:s.chunk_shape,stride:s.get_strides(s.chunk_shape)}}return s.codec.decode(a)}is(r){return Ke(this.dtype,r)}},I=new WeakMap,de),yt=lr();function lr(){let t=new WeakMap;function e(r){var s;let n=(s=t.get(r))!=null?s:{v2:0,v3:0};return t.set(r,n),n}return{increment(r,n){e(r)[n]+=1},version_max(r){let n=e(r);return n.v3>n.v2?"v3":"v2"}}}async function hr(t){let e=await t.store.get(t.resolve(".zattrs").path);return e?nt(e):{}}async function dr(t,e={}){var s;let r="store"in t?t:new O(t),n={};return((s=e.attrs)==null||s)&&(n=await hr(r)),e.kind==="array"?re(r,n):e.kind==="group"?ne(r,n):re(r,n).catch(a=>(ke(a,rt),ne(r,n)))}async function re(t,e){let{path:r}=t.resolve(".zarray"),n=await t.store.get(r);if(!n)throw new rt("v2 array",{cause:new It(r)});return yt.increment(t.store,"v2"),new dt(t.store,t.path,Ge(nt(n),e))}async function ne(t,e){let{path:r}=t.resolve(".zgroup"),n=await t.store.get(r);if(!n)throw new rt("v2 group",{cause:new It(r)});return yt.increment(t.store,"v2"),new Pt(t.store,t.path,qe(nt(n),e))}async function pr(t){let{store:e,path:r}=t.resolve("zarr.json"),n=await t.store.get(r);if(!n)throw new rt("v3 array or group",{cause:new It(r)});let s=nt(n);return s.node_type==="array"&&(s.fill_value=ve(s)),s.node_type==="array"?new dt(e,t.path,s):new Pt(e,t.path,s)}async function yr(t,e={}){let r="store"in t?t:new O(t),n=await pr(r);if(yt.increment(r.store,"v3"),e.kind===void 0||e.kind==="array"&&n instanceof dt||e.kind==="group"&&n instanceof Pt)return n;let s=n instanceof dt?"array":"group";throw new Error("Expected node of kind ".concat(e.kind,", found ").concat(s,"."))}async function M(t,e={}){let r="store"in t?t.store:t,n=yt.version_max(r),s=n==="v2"?M.v2:M.v3,a=n==="v2"?M.v3:M.v2;return s(t,e).catch(o=>(ke(o,rt),a(t,e)))}M.v2=dr;M.v3=yr;function*_r(t,e,r=1){e===void 0&&(e=t,t=0);for(let n=t;n<e;n+=r)yield n}function*gr(...t){if(t.length===0)return;const e=t.map(n=>n[Symbol.iterator]()),r=e.map(n=>n.next());if(r.some(n=>n.done))throw new Error("Input contains an empty iterator.");for(let n=0;;){if(r[n].done){if(e[n]=t[n][Symbol.iterator](),r[n]=e[n].next(),++n>=e.length)return}else yield r.map(({value:s})=>s),n=0;r[n]=e[n].next()}}function br({start:t,stop:e,step:r},n){if(r===0)throw new Error("slice step cannot be zero");r=r!=null?r:1;const s=r<0,[a,o]=s?[-1,n-1]:[0,n];return t===null?t=s?o:a:t<0?(t+=n,t<a&&(t=a)):t>o&&(t=o),e===null?e=s?a:o:e<0?(e+=n,e<a&&(e=a)):e>o&&(e=o),[t,e,r]}function pt(t,e,r=null){return e===void 0&&(e=t,t=null),{start:t,stop:e,step:r}}function mr(){const t=[];return{add:e=>t.push(e()),onIdle:()=>Promise.all(t)}}class Bt extends Error{constructor(e){super(e),this.name="IndexError"}}function wr(t,e){throw new Bt("too many indicies for array; expected ".concat(e.length,", got ").concat(t.length))}function Ar(t){throw new Bt("index out of bounds for dimension with length ".concat(t))}function vr(){throw new Bt("only slices with step >= 1 are supported")}function kr(t,e){t.length>e.length&&wr(t,e)}function Er(t,e){return t=Math.trunc(t),t<0&&(t=e+t),(t>=e||t<0)&&Ar(e),t}class Tr{constructor({dim_sel:e,dim_len:r,dim_chunk_len:n}){w(this,"dim_sel");w(this,"dim_len");w(this,"dim_chunk_len");w(this,"nitems");e=Er(e,r),this.dim_sel=e,this.dim_len=r,this.dim_chunk_len=n,this.nitems=1}*[Symbol.iterator](){const e=Math.floor(this.dim_sel/this.dim_chunk_len),r=e*this.dim_chunk_len,n=this.dim_sel-r;yield{dim_chunk_ix:e,dim_chunk_sel:n}}}class se{constructor({dim_sel:e,dim_len:r,dim_chunk_len:n}){w(this,"start");w(this,"stop");w(this,"step");w(this,"dim_len");w(this,"dim_chunk_len");w(this,"nitems");w(this,"nchunks");const[s,a,o]=br(e,r);this.start=s,this.stop=a,this.step=o,this.step<1&&vr(),this.dim_len=r,this.dim_chunk_len=n,this.nitems=Math.max(0,Math.ceil((this.stop-this.start)/this.step)),this.nchunks=Math.ceil(this.dim_len/this.dim_chunk_len)}*[Symbol.iterator](){const e=Math.floor(this.start/this.dim_chunk_len),r=Math.ceil(this.stop/this.dim_chunk_len);for(const n of _r(e,r)){const s=n*this.dim_chunk_len,a=Math.min(this.dim_len,(n+1)*this.dim_chunk_len),o=a-s;let l=0,f=0;if(this.start<s){const h=(s-this.start)%this.step;h&&(f+=this.step-h),l=Math.ceil((s-this.start)/this.step)}else f=this.start-s;const c=this.stop>a?o:this.stop-s,i=[f,c,this.step],u=Math.ceil((c-f)/this.step),d=[l,l+u,1];yield{dim_chunk_ix:n,dim_chunk_sel:i,dim_out_sel:d}}}}function xr(t,e){let r=[];return t===null?r=e.map(n=>pt(null)):Array.isArray(t)&&(r=t.map(n=>n!=null?n:pt(null))),kr(r,e),r}class Nr{constructor({selection:e,shape:r,chunk_shape:n}){w(this,"dim_indexers");w(this,"shape");this.dim_indexers=xr(e,r).map((s,a)=>new(typeof s=="number"?Tr:se)({dim_sel:s,dim_len:r[a],dim_chunk_len:n[a]})),this.shape=this.dim_indexers.filter(s=>s instanceof se).map(s=>s.nitems)}*[Symbol.iterator](){for(const e of gr(...this.dim_indexers)){const r=e.map(s=>s.dim_chunk_ix),n=e.map(s=>"dim_out_sel"in s?{from:s.dim_chunk_sel,to:s.dim_out_sel}:{from:s.dim_chunk_sel,to:null});yield{chunk_coords:r,mapping:n}}}}function Cr(t,e){return"get"in t?t.get(e):t[e]}async function Sr(t,e,r,n){var f,c;let s=cr(t),a=new Nr({selection:e,shape:t.shape,chunk_shape:t.chunks}),o=n.prepare(new s.TypedArray(a.shape.reduce((i,u)=>i*u,1)),a.shape,s.get_strides(a.shape)),l=(c=(f=r.create_queue)==null?void 0:f.call(r))!=null?c:mr();for(const{chunk_coords:i,mapping:u}of a)l.add(async()=>{let{data:d,shape:h,stride:p}=await t.getChunk(i,r.opts),g=n.prepare(d,h,p);n.set_from_chunk(o,g,u)});return await l.onIdle(),a.shape.length===0?Cr(o.data,0):o}function zt(t,e=0,r){let n=r!=null?r:t.length-e;return{length:n,subarray(s,a=n){return zt(t,e+s,a-s)},set(s,a=0){for(let o=0;o<s.length;o++)t[e+a+o]=s.get(o)},get(s){return t[e+s]}}}function wt(t){return globalThis.Array.isArray(t.data)?{data:zt(t.data),stride:t.stride,bytes_per_element:1}:{data:new Uint8Array(t.data.buffer,t.data.byteOffset,t.data.byteLength),stride:t.stride,bytes_per_element:t.data.BYTES_PER_ELEMENT}}function Mr(t){return"chars"in t?t.constructor.bind(null,t.chars):t.constructor}function jr(t,e){if(globalThis.Array.isArray(t.data))return zt([e]);let r=Mr(t.data),n=new r([e]);return new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}const Ir={prepare(t,e,r){return{data:t,shape:e,stride:r}},set_scalar(t,e,r){let n=wt(t);St(n,e,jr(t,r),n.bytes_per_element)},set_from_chunk(t,e,r){let n=wt(t);ut(n,wt(e),n.bytes_per_element,r)}};async function xe(t,e=null,r={}){return Sr(t,e,r,Ir)}function Ne(t,e,r){return r<0&&e<t?Math.floor((t-e-1)/-r)+1:t<e?Math.floor((e-t-1)/r)+1:0}function St(t,e,r,n){if(e.length===0){t.data.set(r,0);return}const[s,...a]=e,[o,...l]=t.stride;if(typeof s=="number"){const d=t.data.subarray(o*s*n);St({data:d,stride:l},a,r,n);return}const[f,c,i]=s,u=Ne(f,c,i);if(a.length===0){for(let d=0;d<u;d++)t.data.set(r,o*(f+i*d)*n);return}for(let d=0;d<u;d++){const h=t.data.subarray(o*(f+i*d)*n);St({data:h,stride:l},a,r,n)}}function ut(t,e,r,n){const[s,...a]=n,[o,...l]=t.stride,[f,...c]=e.stride;if(s.from===null){if(a.length===0){t.data.set(e.data.subarray(0,r),s.to*r);return}ut({data:t.data.subarray(o*s.to*r),stride:l},e,r,a);return}if(s.to===null){if(a.length===0){let m=s.from*r;t.data.set(e.data.subarray(m,m+r),0);return}ut(t,{data:e.data.subarray(f*s.from*r),stride:c},r,a);return}const[i,u,d]=s.to,[h,p,g]=s.from,A=Ne(i,u,d);if(a.length===0){if(d===1&&g===1&&o===1&&f===1){let m=h*r,v=A*r;t.data.set(e.data.subarray(m,m+v),i*r);return}for(let m=0;m<A;m++){let v=f*(h+g*m)*r;t.data.set(e.data.subarray(v,v+r),o*(i+d*m)*r)}return}for(let m=0;m<A;m++)ut({data:t.data.subarray(o*(i+m*d)*r),stride:l},{data:e.data.subarray(f*(h+m*g)*r),stride:c},r,a)}function Ce(t,e,r,n={}){return e!==void 0&&r!==void 0&&(n={...n,headers:{...n.headers,Range:"bytes=".concat(e,"-").concat(e+r-1)}}),fetch(t,n)}function Rr(t,e){return{...t,...e,headers:{...t.headers,...e.headers}}}function ae(t,e){const r=typeof t=="string"?new URL(t):t;r.pathname.endsWith("/")||(r.pathname+="/");const n=new URL(e.slice(1),r);return n.search=r.search,n}async function ie(t){if(t.status!==404){if(t.status===200||t.status===206)return new Uint8Array(await t.arrayBuffer());throw new Error("Unexpected response status ".concat(t.status," ").concat(t.statusText))}}async function Or(t,e,r,n){if(n)return fetch(t,{...r,headers:{...r.headers,Range:"bytes=-".concat(e)}});let s=await fetch(t,{...r,method:"HEAD"});if(!s.ok)return s;let a=s.headers.get("Content-Length"),o=Number(a);return Ce(t,o-e,o,r)}var Q,Z,tt,Mt;class Se{constructor(e,r={}){E(this,tt);w(this,"url");E(this,Q);E(this,Z);var n,s;this.url=e,k(this,Q,(n=r.overrides)!=null?n:{}),k(this,Z,(s=r.useSuffixRequest)!=null?s:!1)}async get(e,r={}){let n=ae(this.url,e).href,s=await fetch(n,bt(this,tt,Mt).call(this,r));return ie(s)}async getRange(e,r,n={}){let s=ae(this.url,e),a=bt(this,tt,Mt).call(this,n),o;return"suffixLength"in r?o=await Or(s,r.suffixLength,a,_(this,Z)):o=await Ce(s,r.offset,r.length,a),ie(o)}}Q=new WeakMap,Z=new WeakMap,tt=new WeakSet,Mt=function(e){return Rr(_(this,Q),e)};const Lr=globalThis.AudioData,Fr=globalThis.ImageBitmap,Ur=globalThis.VideoFrame,Pr=globalThis.OffscreenCanvas,Br=globalThis.RTCDataChannel,zr=globalThis.MessageChannel,$r=globalThis.ReadableStream,Dr=globalThis.WritableStream,Wr=globalThis.TransformStream,Vr="ReadableStream"in globalThis,Yr="WritableStream"in globalThis,Hr="TransformStream"in globalThis,Jr="MessageChannel"in globalThis,Gr="MessagePort"in globalThis,qr="ArrayBuffer"in globalThis,Kr="AudioData"in globalThis,Xr="ImageBitmap"in globalThis,Qr="VideoFrame"in globalThis,Zr="OffscreenCanvas"in globalThis,tn="RTCDataChannel"in globalThis;function en(t){return typeof t=="object"&&t!==null||typeof t=="function"}function rn(t){return ArrayBuffer.isView(t)}function oe(t){return Vr&&t instanceof $r||Yr&&t instanceof Dr||Hr&&t instanceof Wr}function nn(t){return Jr&&t instanceof zr}function sn(t){return qr&&t instanceof ArrayBuffer||Gr&&t instanceof MessagePort||Kr&&t instanceof Lr||Xr&&t instanceof Fr||Qr&&t instanceof Ur||Zr&&t instanceof Pr||tn&&t instanceof Br}function _t(t,e=!1,r=1e4){const n=new Set([]),s=[[t]];for(let a=0;a<s.length;a++){const o=s[a],l=o.length;for(let f=0;f<l;f++){const c=o[f];if(rn(c))n.add(c.buffer);else if(sn(c)||e&&oe(c))n.add(c);else if(nn(c))n.add(c.port1),n.add(c.port2);else if(!oe(c)&&en(c)){const i=Array.isArray(c)?c:Object.values(c);i.length&&s.push(i)}}if(--r<=0)break}return Array.from(n)}function an(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var At,ue;function on(){if(ue)return At;ue=1;function t(e){for(var r=new Array(e),n=0;n<e;++n)r[n]=n;return r}return At=t,At}/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var vt,ce;function un(){if(ce)return vt;ce=1,vt=function(r){return r!=null&&(t(r)||e(r)||!!r._isBuffer)};function t(r){return!!r.constructor&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function e(r){return typeof r.readFloatLE=="function"&&typeof r.slice=="function"&&t(r.slice(0,0))}return vt}var kt,fe;function cn(){if(fe)return kt;fe=1;var t=on(),e=un(),r=typeof Float64Array<"u";function n(c,i){return c[0]-i[0]}function s(){var c=this.stride,i=new Array(c.length),u;for(u=0;u<i.length;++u)i[u]=[Math.abs(c[u]),u];i.sort(n);var d=new Array(i.length);for(u=0;u<d.length;++u)d[u]=i[u][1];return d}function a(c,i){var u=["View",i,"d",c].join("");i<0&&(u="View_Nil"+c);var d=c==="generic";if(i===-1){var h="function "+u+"(a){this.data=a;};	var proto="+u+".prototype;	proto.dtype='"+c+"';	proto.index=function(){return -1};	proto.size=0;	proto.dimension=-1;	proto.shape=proto.stride=proto.order=[];	proto.lo=proto.hi=proto.transpose=proto.step=	function(){return new "+u+"(this.data);};	proto.get=proto.set=function(){};	proto.pick=function(){return null};	return function construct_"+u+"(a){return new "+u+"(a);}",z=new Function(h);return z()}else if(i===0){var h="function "+u+"(a,d) {	this.data = a;	this.offset = d	};	var proto="+u+".prototype;	proto.dtype='"+c+"';	proto.index=function(){return this.offset};	proto.dimension=0;	proto.size=1;	proto.shape=	proto.stride=	proto.order=[];	proto.lo=	proto.hi=	proto.transpose=	proto.step=function "+u+"_copy() {	return new "+u+"(this.data,this.offset)	};	proto.pick=function "+u+"_pick(){	return TrivialArray(this.data);	};	proto.valueOf=proto.get=function "+u+"_get(){	return "+(d?"this.data.get(this.offset)":"this.data[this.offset]")+"};	proto.set=function "+u+"_set(v){	return "+(d?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"	};	return function construct_"+u+"(a,b,c,d){return new "+u+"(a,d)}",z=new Function("TrivialArray",h);return z(l[c][0])}var h=["'use strict'"],p=t(i),g=p.map(function(y){return"i"+y}),A="this.offset+"+p.map(function(y){return"this.stride["+y+"]*i"+y}).join("+"),m=p.map(function(y){return"b"+y}).join(","),v=p.map(function(y){return"c"+y}).join(",");h.push("function "+u+"(a,"+m+","+v+",d){this.data=a","this.shape=["+m+"]","this.stride=["+v+"]","this.offset=d|0}","var proto="+u+".prototype","proto.dtype='"+c+"'","proto.dimension="+i),h.push("Object.defineProperty(proto,'size',{get:function "+u+"_size(){	return "+p.map(function(y){return"this.shape["+y+"]"}).join("*"),"}})"),i===1?h.push("proto.order=[0]"):(h.push("Object.defineProperty(proto,'order',{get:"),i<4?(h.push("function "+u+"_order(){"),i===2?h.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):i===3&&h.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);	if(s0>s1){	if(s1>s2){	return [2,1,0];	}else if(s0>s2){	return [1,2,0];	}else{	return [1,0,2];	}	}else if(s0>s2){	return [2,0,1];	}else if(s2>s1){	return [0,1,2];	}else{	return [0,2,1];	}}})")):h.push("ORDER})")),h.push("proto.set=function "+u+"_set("+g.join(",")+",v){"),d?h.push("return this.data.set("+A+",v)}"):h.push("return this.data["+A+"]=v}"),h.push("proto.get=function "+u+"_get("+g.join(",")+"){"),d?h.push("return this.data.get("+A+")}"):h.push("return this.data["+A+"]}"),h.push("proto.index=function "+u+"_index(",g.join(),"){return "+A+"}"),h.push("proto.hi=function "+u+"_hi("+g.join(",")+"){return new "+u+"(this.data,"+p.map(function(y){return["(typeof i",y,"!=='number'||i",y,"<0)?this.shape[",y,"]:i",y,"|0"].join("")}).join(",")+","+p.map(function(y){return"this.stride["+y+"]"}).join(",")+",this.offset)}");var N=p.map(function(y){return"a"+y+"=this.shape["+y+"]"}),L=p.map(function(y){return"c"+y+"=this.stride["+y+"]"});h.push("proto.lo=function "+u+"_lo("+g.join(",")+"){var b=this.offset,d=0,"+N.join(",")+","+L.join(","));for(var b=0;b<i;++b)h.push("if(typeof i"+b+"==='number'&&i"+b+">=0){	d=i"+b+"|0;	b+=c"+b+"*d;	a"+b+"-=d}");h.push("return new "+u+"(this.data,"+p.map(function(y){return"a"+y}).join(",")+","+p.map(function(y){return"c"+y}).join(",")+",b)}"),h.push("proto.step=function "+u+"_step("+g.join(",")+"){var "+p.map(function(y){return"a"+y+"=this.shape["+y+"]"}).join(",")+","+p.map(function(y){return"b"+y+"=this.stride["+y+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var b=0;b<i;++b)h.push("if(typeof i"+b+"==='number'){	d=i"+b+"|0;	if(d<0){	c+=b"+b+"*(a"+b+"-1);	a"+b+"=ceil(-a"+b+"/d)	}else{	a"+b+"=ceil(a"+b+"/d)	}	b"+b+"*=d	}");h.push("return new "+u+"(this.data,"+p.map(function(y){return"a"+y}).join(",")+","+p.map(function(y){return"b"+y}).join(",")+",c)}");for(var st=new Array(i),Ht=new Array(i),b=0;b<i;++b)st[b]="a[i"+b+"]",Ht[b]="b[i"+b+"]";h.push("proto.transpose=function "+u+"_transpose("+g+"){"+g.map(function(y,je){return y+"=("+y+"===undefined?"+je+":"+y+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+u+"(this.data,"+st.join(",")+","+Ht.join(",")+",this.offset)}"),h.push("proto.pick=function "+u+"_pick("+g+"){var a=[],b=[],c=this.offset");for(var b=0;b<i;++b)h.push("if(typeof i"+b+"==='number'&&i"+b+">=0){c=(c+this.stride["+b+"]*i"+b+")|0}else{a.push(this.shape["+b+"]);b.push(this.stride["+b+"])}");h.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),h.push("return function construct_"+u+"(data,shape,stride,offset){return new "+u+"(data,"+p.map(function(y){return"shape["+y+"]"}).join(",")+","+p.map(function(y){return"stride["+y+"]"}).join(",")+",offset)}");var z=new Function("CTOR_LIST","ORDER",h.join("\n"));return z(l[c],s)}function o(c){if(e(c))return"buffer";if(r)switch(Object.prototype.toString.call(c)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(c)?"array":"generic"}var l={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};function f(c,i,u,d){if(c===void 0){var v=l.array[0];return v([])}else typeof c=="number"&&(c=[c]);i===void 0&&(i=[c.length]);var h=i.length;if(u===void 0){u=new Array(h);for(var p=h-1,g=1;p>=0;--p)u[p]=g,g*=i[p]}if(d===void 0){d=0;for(var p=0;p<h;++p)u[p]<0&&(d-=(i[p]-1)*u[p])}for(var A=o(c),m=l[A];m.length<=h+1;)m.push(a(A,m.length-1));var v=m[h+1];return v(c,i,u,d)}return kt=f,kt}var fn=cn(),it=an(fn);const Me=t=>"https://raudfinn.smd.sintef.no/raudsat/output/latest/raudsat_"+t+".zarr",ln=async t=>{const e=Te(new Se(Me(t))),r=await M.v3(e.resolve("/spectral_distance"),{kind:"array"});if(!r.is("float32"))throw Error("Variable data type not expected!");const n=await xe(r,[pt(null),pt(null)]),s={data:n.data,shape:Int32Array.from(n.shape,a=>a),stride:Int32Array.from(n.stride,a=>a)};return et(s,_t(s))},hn=async(t,e)=>{const r=Te(new Se(Me(t))),n=await M.v3(r.resolve(e),{kind:"array"});if(!n.is("float32"))throw Error("Coordinate data type not supported!");const s=await xe(n,[null]);return et(s,_t(s))},dn=async(t,e,r,n,s)=>{const a=it(e.data,Array.from(e.shape),Array.from(e.stride)),o=it(r.data,Array.from(r.shape),Array.from(r.stride)),l=it(n.data,Array.from(n.shape),Array.from(n.stride)),f=it(s.data,Array.from(s.shape),Array.from(s.stride)),c=new Array(t.lat.length);let i=0;const u=new Array(8);u[0]=new Float64Array(t.lat.length),u[1]=new Float64Array(t.lat.length),u[2]=new Float64Array(t.lat.length),u[3]=new Float64Array(t.lat.length),u[4]=new Float64Array(t.lat.length),u[5]=new Float64Array(t.lat.length),u[6]=new Float64Array(t.lat.length),u[7]=new Float64Array(t.lat.length),i=0;const d=c.length;for(let p=0;p<d;++p){const g=[t.latIdx[p],t.lngIdx[p],t.lng[p],t.lat[p],t.deltaLng[p],t.deltaLat[p]];let A=NaN,m=NaN,v=NaN,N=NaN;A=a.get(g[0],g[1]),m=o.get(g[0],g[1]),v=l.get(g[0],g[1]),N=f.get(g[0],g[1]),!(isNaN(A)&&isNaN(m)&&isNaN(v)&&isNaN(N))&&(u[0][i]=g[2],u[1][i]=g[3],u[2][i]=g[4],u[3][i]=g[5],u[4][i]=A,u[5][i]=m,u[6][i]=v,u[7][i++]=N)}const h={lng:u[0].slice(0,i),lat:u[1].slice(0,i),half_width:u[2].slice(0,i),half_height:u[3].slice(0,i),spec_dist3:u[4].slice(0,i),spec_dist5:u[5].slice(0,i),spec_dist7:u[6].slice(0,i),spec_dist11:u[7].slice(0,i)};return et(h,_t(h))},pn=async(t,e)=>{let r=0;const n={data:t.data,shape:Array.from(t.shape),stride:Array.from(t.stride)},s={data:e.data,shape:Array.from(e.shape),stride:Array.from(e.stride)},a=new Array(s.shape[0]*n.shape[0]);for(let c=0;c<s.shape[0];++c)for(let i=0;i<n.shape[0];++i)a[r++]=[c,i];const o=n.shape[0],l=s.shape[0],f={latIdx:new Float64Array(a.length),lngIdx:new Float64Array(a.length),lng:new Float64Array(a.length),lat:new Float64Array(a.length),deltaLng:new Float64Array(a.length),deltaLat:new Float64Array(a.length)};return r=0,a.forEach(c=>{let i=0,u=0;const d=c[1]!=0,h=c[1]!=o-1,p=c[0]!=0,g=c[0]!=l-1,A=n.data[c[1]],m=s.data[c[0]];d&&h?i=Math.abs(n.data[c[1]-1]-n.data[c[1]+1])/4:d?i=Math.abs(n.data[c[1]-1]-A)/2:h&&(i=Math.abs(n.data[c[1]+1]-A)/2),p&&g?u=Math.abs(s.data[c[0]-1]-s.data[c[0]+1])/4:p?u=Math.abs(s.data[c[0]-1]-m)/2:g&&(u=Math.abs(s.data[c[0]+1]-m)/2),f.latIdx[r]=c[0],f.lngIdx[r]=c[1],f.lng[r]=A,f.lat[r]=m,f.deltaLng[r]=i,f.deltaLat[r++]=u}),et(f,_t(f))};var yn=Object.freeze({__proto__:null,raudsatCoord:hn,raudsatCoordTable:pn,raudsatOutputArray:dn,raudsatVarQuery:ln});jt(yn);
