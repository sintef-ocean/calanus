System.register(["./render-legacy-DDx73_w7.js","./index-legacy-CKAyoBaI.js"],(function(e,t){"use strict";var a,n,o,l,r,i,s,d,m,u,c,p,v,g,y,h,f,A,b,N,w,S,I,_,F,x,L,D,C,M,O,z,R,T,k,P,E,U,B,W,Q,Z,q,H,J,K,X,j,G,V,Y;return{setters:[e=>{a=e.u,n=e.a,o=e.n,l=e.E,r=e.r,i=e.o,s=e.p,d=e.i,m=e.q,u=e.c,c=e.s,p=e.k,v=e.m,g=e.l,y=e.g,h=e.f,f=e.j,A=e.h,b=e.t,N=e.T,w=e.I,S=e.U},e=>{I=e.d,_=e.u,F=e.F,x=e.G,L=e.H,D=e.J,C=e.K,M=e.L,O=e.M,z=e.r,R=e.N,T=e.O,k=e.P,P=e.c,E=e.R,U=e.Q,B=e.S,W=e.T,Q=e.U,Z=e.V,q=e.W,H=e.b,J=e.e,K=e.h,X=e.f,j=e.X,G=e.Y,V=e.p,Y=e._}],execute:function(){var t=document.createElement("style");t.textContent=".chart[data-v-a705fbb8]{position:absolute;width:100%;height:100%}\n/*$vite$:1*/",document.head.appendChild(t);const $=80640,ee=1e5;e("R",Y(I({__name:"RaudMap",setup(e,{expose:t}){a([d,m,u,c,p,v,g,y,h,f,A,b]);const{t:I,locale:Y}=_({useScope:"local"}),{theme:te,initOptions:ae}=n(),ne=F(),oe=x(),{coordsFormat:le}=L(ne),{POIs:re,locationActive:ie}=L(oe),{coords:se,locatedAt:de}=D();C(se,(()=>{const e=se.value.latitude,t=se.value.longitude,a=se.value.accuracy;e&&t&&e<1/0&&t<1/0&&de.value&&a&&oe.addPoi("locate",M.latLng(e,t),new Date(de.value),a)})),C(re.value,(()=>{const e=oe.getPoi("click"),t=oe.getPoi("locate");e?ce.value.setLatLng(e.position):t&&pe.value.setLatLng(t.position)})),C(ie,(()=>{ge.value&&ie.value==oe.MarkerState.Clearable?pe.value.addTo(ge.value):ge.value&&ie.value==oe.MarkerState.Placeable&&ge.value.removeLayer(pe.value)}));const me=M.icon({iconUrl:O("pin","svg"),iconSize:[40,40],iconAnchor:[20,39],tooltipAnchor:[5,-33],className:"raudfinn-marker"}),ue=M.icon({iconUrl:O("locate","svg"),iconSize:[40,40],iconAnchor:[20,20],tooltipAnchor:[5,0],className:"raudfinn-marker"}),ce=z(M.marker([0,0],{icon:me}));ce.value.bindTooltip((e=>o(ce.value.getLatLng()).format(le.value)));const pe=z(M.marker([0,0],{icon:ue}));pe.value.bindTooltip((e=>{const t=oe.getPoi("locate");let a="";if(t&&(a=new Intl.DateTimeFormat(Y.value,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!1,timeZoneName:"short"}).format(t.when),a+="<br><b>",a+=I("Accuracy")+": "+t.text+"</b> m",e)){const a=e.getTooltip();if(a&&t.text&&"number"==typeof t.text&&t.text>100&&a.getElement()instanceof HTMLElement){const e=a.getElement();e&&M.DomUtil.addClass(e,"raudfinn-warning")}}return o(pe.value.getLatLng()).format(le.value)+"<br>"+a}));const ve=z({}),ge=z({}),ye=z([]),he=z(-1);V(N,te),V(w,ae),V(S,{notMerge:!1,lazyUpdate:!0});const{data:fe}=R("3d"),{data:Ae}=R("5d"),{data:be}=R("7d"),{data:Ne}=R("11d"),{arrayQuery:we}=T(),Se=k(),{activeRaudsatLayer:Ie,activeRaudsatLayerName:_e}=L(Se),Fe=P((()=>{let e=0,t=0,a={start:new Date,end:new Date};switch(Ie.value){case E.spectral_distance_3d:e=3,t=4,fe.value&&(a=fe.value);break;case E.spectral_distance_5d:e=5,t=5,Ae.value&&(a=Ae.value);break;case E.spectral_distance_7d:e=7,t=6,be.value&&(a=be.value);break;case E.spectral_distance_11d:e=11,t=7,Ne.value&&(a=Ne.value)}return{description:I("Raudsat "+e),value_range:[0,.15],color_range:[0,.15],visible_range:[0,.15],period:a,dimension:t,text:[I("Bad"),I("Similarity")+"\n"+I("Ocean color").toLowerCase()+"\n"+I("Good")],inverse:!0,colors:U({colormap:"viridis",nshades:20,format:"rgbaString",alpha:.8})}})),xe=B("midnor");xe.setSpaceStride(3);const{timeStride:Le,spaceStride:De,region:Ce,boundingBox:Me,activeLayer:Oe,activeLayerName:ze,sinmod_info:Re}=L(xe),{data:Te}=W(Le,Ce),{array:ke}=Q(Le,De,Ce,Me),Pe=z(0),Ee=Z(Me),Ue=P((()=>ke.value?.length>Pe.value&&ke.value[Pe.value].isSuccess?ke.value[Pe.value].data:[[0,0,.1,.1,.2,0,.1,-.1,"2025",1,1,1,1,1,1,1,1]])),Be=z(7),We=z(Z(Me)),Qe=z(Z(Me)),Ze=q();C(Be,(()=>{const e=Be.value;if(Be.value>8.5){const e=Z(We),t=.2*(e.lng[1]-e.lng[0]),a=.2*(e.lat[1]-e.lat[0]);e.lat=[e.lat[0]-a,e.lat[1]+a],e.lng=[e.lng[0]-t,e.lng[1]+t],Qe.value=Z(Me),Qe.value.lng[0]-Ee.lng[0]>1e-5&&(console.log("Remove queries with bounds:",Qe.value),Ze.removeQueries({queryKey:["sinmod",Z(Ce),Z(Qe)],exact:!1}))}else xe.setBoundingBox(Ee);var t;xe.setSpaceStride((t=e)>8.5||t<=8.5&&t>8?2:3)})),C(We,((e,t)=>{try{ve.value?.setOption({dataset:{fromDatasetId:"sinmod-dataset",id:"sinmod-dataset-filtered",transform:{type:"filter",config:{and:[{dimension:"lng0",">":We.value.lng[0],"<":We.value.lng[1]},{dimension:"lat0",">":We.value.lat[0],"<":We.value.lat[1]}]}}}})}catch{}}));const qe=z(!0),He=()=>{try{ve.value?.setOption({visualMap:{id:"sinmod",text:Re.value.text,show:!0,right:0,padding:8,top:172,itemWidth:24,itemHeight:80,handleSize:"140%",calculable:!0,realtime:!0,outOfRange:{color:["rgba(127,127,127,0.2)","rgba(127,127,127,0.2)"],colorAlpha:[0,0]},type:"continuous",seriesIndex:1,precision:2,inverse:!1,dimension:Re.value.dimension,min:Re.value.color_range[0],max:Re.value.color_range[1],range:Re.value.visible_range,inRange:{color:Re.value.colors}}})}catch{}},Je=()=>{try{ve.value?.setOption({visualMap:{id:"raudsat",text:Fe.value.text,show:!0,right:0,padding:8,top:0,itemWidth:24,itemHeight:80,handleSize:"140%",calculable:!0,realtime:!0,outOfRange:{color:["rgba(127,127,127,0.2)","rgba(127,127,127,0.2)"],colorAlpha:[0,0]},type:"continuous",seriesIndex:0,dimension:Fe.value.dimension,precision:2,inverse:Fe.value.inverse,min:Fe.value.color_range[0],max:Fe.value.color_range[1],range:Fe.value.visible_range,inRange:{color:Fe.value.colors}}})}catch{}},Ke=()=>{const e=new Array;Te.value?.timestrings.forEach(((t,a)=>{e.push({series:[{},{datasetId:"sinmod-dataset-"+Number(a).toString(10)}]}),ve.value?.setOption({dataset:{fromDatasetId:"sinmod-dataset-filtered",id:"sinmod-dataset-"+Number(a).toString(10),transform:{type:"filter",config:{dimension:"time","=":t,parser:"time"},print:!1}}})})),ve.value?.setOption({timeline:{data:Te.value?.timestrings},options:e})},Xe=()=>{we.data.value&&ve.value?.setOption({dataset:{id:"raudsat-dataset",source:we.data.value}})},je=async()=>{ve.value?.setOption({dataset:{id:"sinmod-dataset",source:Ue.value}})};C(Re,(()=>{He()})),C(Fe,(()=>{Je()})),C(Te,(()=>{Ke()})),C(we.data,(()=>{Xe()})),C(Ue,(()=>{je()}));const Ge={backgroundColor:"rgba(255,255,255,0)",legend:{textStyle:{fontSize:14},top:1,borderWidth:1,borderRadius:2,left:"center",orient:"vertical",selectedMode:"single",show:!0,selected:{Raudsat:!1,"SINMOD - MIDNOR":!0}},timeline:{left:"5%",right:"5%",bottom:10,show:!0,axisType:"category",symbol:"roundRect",realtime:!0,loop:!0,autoPlay:!1,controlStyle:{showPlayBtn:!0,stopIcon:"image://data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAGpJREFUWAntlkEKwDAIBKP+/znt82xrD6FIpSSHXDpCQBeXDXOyNQoCBQEz21T1eL7QivUuj/qkO1MTwUm6R3cvPbEw6tO3kJUaH4AABCAAAQhAAAIQgEBJQET2fJxe2udZPuvLWcz/IXACuUMWMJDzUAgAAAAASUVORK5CYII=",playIcon:"path://M41.365908,29.4271388 L41.3664843,29.4265626 L26.3794329,19.1497136 L26.3747509,19.1541315 C26.0642269,18.8592621 25.6429678,18.677793 25.1786824,18.677793 C24.2236284,18.677793 23.4494433,19.4443188 23.4494433,20.3905371 C23.4494433,20.910214 23.4270417,21.9276946 23.4494433,21.9056292 L23.4494433,30.6673861 L23.4494433,39.8901629 C23.4494433,39.8977982 23.4494433,40.4825908 23.4494433,40.9444991 C23.4494433,41.8901412 24.2236284,42.656691 25.1786824,42.656691 C25.6447205,42.656691 26.0677564,42.4740454 26.3782564,42.1764869 L26.3794329,42.1770872 L41.3664843,31.9005503 L41.3659081,31.8996379 C41.6917266,31.5882735 41.894997,31.1514078 41.894997,30.6670739 C41.894997,30.6658974 41.894997,30.6650091 41.894997,30.6635444 C41.894997,30.6623679 41.894997,30.6609273 41.894997,30.6600389 C41.894997,30.175657 41.6917265,29.7384792 41.365908,29.4271388 Z"},symbolSize:15,playInterval:750,itemStyle:{borderWidth:2},emphasis:{label:{fontSize:14,fontWeight:"bolder"}},checkpointStyle:{symbol:"pin",symbolSize:16},lineStyle:{width:3},label:{align:"left",fontSize:14,fontWeight:"bold",padding:2,formatter:function(e,t){if(t%6==0){const t={month:"short",day:"numeric",timeZoneName:"short",hour:"numeric",minute:"numeric",hour12:!1};return new Intl.DateTimeFormat(Y.value,t).format(new Date(K(e).toDate()))}if(t%6==1)return"";{const t={hour:"numeric",minute:"numeric",hour12:!1};return new Intl.DateTimeFormat(Y.value,t).format(new Date(K(e).toDate()))}}},tooltip:{textStyle:{fontSize:14},formatter:e=>new Intl.DateTimeFormat(Y.value,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!1,timeZoneName:"short"}).format(new Date(K(e.name).toDate()))}},tooltip:{},toolbox:{itemSize:24,top:32,left:64,orient:"vertical",feature:{saveAsImage:{name:"raudfinn",backgroundColor:"rgba(255,255,255,1)",excludeComponents:["toolbox"],iconStyle:{borderColor:"#4170f0",borderWidth:2},emphasis:{iconStyle:{textFill:"rgba(0,0,0,1)",textBackgroundColor:"rgba(255,255,255,0.7)",textPadding:4}}}}},lmap:{attributionControl:!1,center:[7.5,65],zoom:7,minZoom:6,resizeEnable:!0,renderOnMoving:!1,echartsLayerInteractive:!0,largeMode:!1,zoomControl:!1,zoomSnap:.5,zoomDelta:.5,zoomAnimation:!1,fadeAnimation:!1,wheelPxPerZoomLevel:120},dataset:(()=>{const e=new Array;return e.push({id:"raudsat-dataset",dimensions:[{type:"float",name:"lng"},{type:"float",name:"lat"},{type:"float",name:"half_width"},{type:"float",name:"half_height"},{type:"float",name:"spec_dist3"},{type:"float",name:"spec_dist5"},{type:"float",name:"spec_dist7"},{type:"float",name:"spec_dist11"}],source:{lng:new Float64Array($).map((()=>NaN)),lat:new Float64Array($).map((()=>NaN)),half_width:new Float64Array($).map((()=>NaN)),half_height:new Float64Array($).map((()=>NaN)),spec_dist3:new Float64Array($).map((()=>NaN)),spec_dist5:new Float64Array($).map((()=>NaN)),spec_dist7:new Float64Array($).map((()=>NaN)),spec_dist11:new Float64Array($).map((()=>NaN))}}),e.push({id:"sinmod-dataset",dimensions:[{type:"float",name:"id"},{type:"float",name:"lng0"},{type:"float",name:"lat0"},{type:"float",name:"lng1"},{type:"float",name:"lat1"},{type:"float",name:"lng2"},{type:"float",name:"lat2"},{type:"float",name:"lng3"},{type:"float",name:"lat3"},{type:"time",name:"time"},{type:"float",name:"calanus_finmarchicus"},{type:"float",name:"diatoms"},{type:"float",name:"flagellates"},{type:"float",name:"temperature"},{type:"float",name:"salinity"},{type:"float",name:"u_east"},{type:"float",name:"v_north"},{type:"float",name:"current"}],source:{id:new Float64Array(ee).map((()=>NaN)),lng0:new Float64Array(ee).map((()=>NaN)),lat0:new Float64Array(ee).map((()=>NaN)),lng1:new Float64Array(ee).map((()=>NaN)),lat1:new Float64Array(ee).map((()=>NaN)),lng2:new Float64Array(ee).map((()=>NaN)),lat2:new Float64Array(ee).map((()=>NaN)),lng3:new Float64Array(ee).map((()=>NaN)),lat3:new Float64Array(ee).map((()=>NaN)),time:new Array(ee).map((()=>"")),calanus_finmarchicus:new Float64Array(ee).map((()=>NaN)),diatoms:new Float64Array(ee).map((()=>NaN)),flagellates:new Float64Array(ee).map((()=>NaN)),temperature:new Float64Array(ee).map((()=>NaN)),salinity:new Float64Array(ee).map((()=>NaN)),u_east:new Float64Array(ee).map((()=>NaN)),v_north:new Float64Array(ee).map((()=>NaN)),current:new Float64Array(ee).map((()=>NaN))}}),e.push({fromDatasetId:"sinmod-dataset",id:"sinmod-dataset-filtered",transform:{type:"filter",config:{and:[{dimension:"lng0",">":We.value.lng[0],"<":We.value.lng[1]},{dimension:"lat0",">":We.value.lat[0],"<":We.value.lat[1]}]}}}),e})(),visualMap:[{id:"raudsat"},{id:"sinmod"}],series:[{type:"custom",coordinateSystem:"lmap",name:"Raudsat",id:"raud",renderItem:r(Fe),tooltip:{position:(e,t,a,n,o)=>({bottom:60,left:20}),formatter:e=>{let t="";if(e.value&&e.dimensionNames){const a=e.value,n=a[1],l=a[0],r=a[1]+2*a[3],i=a[0]+2*a[2],s=ge.value?.distance(M.latLng(n,l),M.latLng(r,l)),d=ge.value?.distance(M.latLng(n,l),M.latLng(n,i)),m=Fe.value.dimension,u=new Intl.DateTimeFormat(Y.value,{year:"numeric",month:"short",day:"numeric"}).format(Fe.value.period.start),c=new Intl.DateTimeFormat(Y.value,{year:"numeric",month:"short",day:"numeric"}).format(Fe.value.period.end);return t+='<table class="raudfinn-item">',t+='<tr><th colspan=2 align="center">'+e.marker+" "+Fe.value.description+"</th></tr>",t+="<tr><td><b>"+I(e.dimensionNames[m])+'</b></td><td align="right">'+a[m].toFixed(2)+"</td></tr>",t+="<tr><td><b>"+I("Timeperiod")+'</b></td><td align="right">'+u+" - "+c+"</td></tr>",t+="<tr><td><b>"+I("Position")+'</b></td><td align="right">'+o({lng:l,lat:n}).format(le.value)+"</td></tr>",t+="<tr><td><b>"+I("Resolution")+' (lat x lon)</b></td><td align="right">'+s.toFixed(0)+" x "+d.toFixed(0)+" m</td></tr>",t+="</table>",t}return""}},datasetId:"raudsat-dataset",progressive:1e4,progressiveChunkMode:"sequential",animation:!1},{type:"custom",coordinateSystem:"lmap",name:"SINMOD - MIDNOR",id:"midnor",renderItem:i(Re),tooltip:{position:(e,t,a,n,o)=>({bottom:60,left:20}),formatter:e=>{if(e.value&&e.dimensionNames){let t="";const a=e.value,n=a[2],l=a[1],r=a[4],i=a[3],s=a[6],d=a[5],m=a[8],u=a[7],c=.25*(n+r+s+m),p=.25*(l+i+d+u),v=ge.value?.distance(M.latLng(n,l),M.latLng(r,i)),g=ge.value?.distance(M.latLng(n,l),M.latLng(m,u)),y=.5*(v+g),h=9,f=new Intl.DateTimeFormat(Y.value,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!1,timeZoneName:"short"}).format(K(a[h]).toDate());return t+='<table class="raudfinn-item">',t+='<tr><th colspan=3 align="center">'+e.marker+" "+Re.value.description+"</th></tr>",t+="<tr><td><b>"+I("Timepoint")+'</b></td><td colspan=2 align="right">'+f+"</td></tr>",t+="<tr><td><b>"+I("Position")+'</b></td><td colspan=2 align="right">'+o({lng:p,lat:c}).format(le.value)+"</td></tr>",t+="<tr><td><b>"+I("Resolution")+'</b></td><td align="right">'+y.toFixed(0)+"</td><td>m</td></tr>",t+='<tr><td colspan=3 class="raudfinn-item-td"></td></tr>',Object.values(G).forEach((n=>{e.dimensionNames&&(t+="<tr><td><b>"+I(e.dimensionNames[n.dimension])+'</b></td><td align="right">'+a[n.dimension].toFixed(2)+"</td><td>"+n.unit+"</td></tr>")})),t+="</table>",t}return""}},datasetId:"sinmod-dataset",progressive:1e4,progressiveChunkMode:"sequential",animation:!1}]},Ve=z(!0);C(te,(()=>{Ve.value=!0,Ye()})),C(ae,(()=>{Ve.value=!0,Ye()})),C(ve,((e,t)=>{Ve.value=!0,Ye()})),C(ge,((e,t)=>{Xe(),je()}));const Ye=()=>{setTimeout((()=>{if(Ve.value&&(Ve.value=!s(he,ge,ve,ye),ve.value?.setOption(Ge),Je(),He(),Ke()),ge.value)try{ge.value.invalidateSize(),ce.value.addTo(ge.value),Be.value=ge.value.getZoom(),ge.value.on("moveend",(e=>{const t=ge.value.getBounds(),a=t.getEast()-t.getWest(),n=t.getNorth()-t.getSouth(),o=.05;We.value={lng:[t.getWest()-o*a,t.getEast()+o*a],lat:[t.getSouth()-o*n,t.getNorth()+o*n]}})),ge.value.on("zoomend",(e=>{Be.value=ge.value.getZoom()}))}catch{console.warn("Map does not exist yet")}}),50)},$e=e=>{qe.value!=e.selected["SINMOD - MIDNOR"]&&(qe.value=e.selected["SINMOD - MIDNOR"])},et=e=>{e.playState&&!qe.value&&((async e=>{const t=await j.create({message:e,duration:3e3,position:"middle"});await t.present()})(I("SINMOD disabled")),ve.value?.dispatchAction({type:"timelinePlayChange",playState:!1}))},tt=e=>{Pe.value=e.currentIndex},at=e=>{"sinmod"===e.visualMapId?Re.value.value_range=e.selected:"raudsat"===e.visualMapId&&(Fe.value.value_range=e.selected)},nt=e=>{setTimeout((()=>{ve.value&&ve.value.dispatchAction({type:"hideTip"})}),3e3)};return t({doPlot:Ye}),(e,t)=>(X(),H(J(l),{ref_key:"theChart",ref:ve,class:"chart","manual-update":!0,autoresize:!0,option:Ge,onClick:nt,onDatarangeselected:at,onLegendselectchanged:$e,onTimelineplaychanged:et,onTimelinechanged:tt},null,512))}}),[["__scopeId","data-v-a705fbb8"]]))}}}));
