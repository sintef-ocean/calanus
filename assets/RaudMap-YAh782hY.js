import{u as We,a as Qe,n as E,E as Ze,r as $e,o as Ke,p as Ve,i as qe,q as He,c as Je,s as Xe,k as Ye,m as Ge,l as je,g as et,f as tt,j as at,h as nt,t as ot,T as st,I as lt,U as rt}from"./render-B3rKqHXx.js";import{d as it,u as dt,F as ut,G as ct,H as z,J as mt,K as d,L as u,M as fe,r as m,N as P,O as pt,P as ft,c as ge,R as B,Q as gt,S as vt,T as yt,U as ht,V as N,W as At,b as Nt,e as bt,h as U,f as St,X as _t,Y as wt,p as X,_ as It}from"./index-D42ZD87f.js";const y=80640,l=1e5,Lt=it({__name:"RaudMap",setup(xt,{expose:ve}){We([qe,He,Je,Xe,Ye,Ge,je,et,tt,at,nt,ot]);const{t:r,locale:h}=dt({useScope:"local"}),{theme:Y,initOptions:G}=Qe(),ye=ut(),A=ct(),{coordsFormat:L}=z(ye),{POIs:he,locationActive:W}=z(A),{coords:x,locatedAt:j}=mt();d(x,()=>{const e=x.value.latitude,t=x.value.longitude,a=x.value.accuracy;e&&t&&e<1/0&&t<1/0&&j.value&&a&&A.addPoi("locate",u.latLng(e,t),new Date(j.value),a)}),d(he.value,()=>{const e=A.getPoi("click"),t=A.getPoi("locate");e?D.value.setLatLng(e.position):t&&b.value.setLatLng(t.position)}),d(W,()=>{s.value&&W.value==A.MarkerState.Clearable?b.value.addTo(s.value):s.value&&W.value==A.MarkerState.Placeable&&s.value.removeLayer(b.value)});const Ae=u.icon({iconUrl:fe("pin","svg"),iconSize:[40,40],iconAnchor:[20,39],tooltipAnchor:[5,-33],className:"raudfinn-marker"}),Ne=u.icon({iconUrl:fe("locate","svg"),iconSize:[40,40],iconAnchor:[20,20],tooltipAnchor:[5,0],className:"raudfinn-marker"}),D=m(u.marker([0,0],{icon:Ae}));D.value.bindTooltip(e=>E(D.value.getLatLng()).format(L.value));const b=m(u.marker([0,0],{icon:Ne}));b.value.bindTooltip(e=>{const t=A.getPoi("locate");let a="";if(t&&(a=new Intl.DateTimeFormat(h.value,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!1,timeZoneName:"short"}).format(t.when),a+="<br><b>",a+=r("Accuracy")+": "+t.text+"</b> m",e)){const o=e.getTooltip();if(o&&t.text&&typeof t.text=="number"&&t.text>100&&o.getElement()instanceof HTMLElement){const n=o.getElement();n&&u.DomUtil.addClass(n,"raudfinn-warning")}}return E(b.value.getLatLng()).format(L.value)+"<br>"+a});const be={notMerge:!1,lazyUpdate:!0},c=m({}),s=m({}),Se=m([]),_e=m(-1);X(st,Y),X(lt,G),X(rt,be);const we=async e=>{await(await _t.create({message:e,duration:3e3,position:"middle"})).present()},{data:ee}=P("3d"),{data:te}=P("5d"),{data:ae}=P("7d"),{data:ne}=P("11d"),{arrayQuery:oe}=pt(),Ie=ft(),{activeRaudsatLayer:Le,activeRaudsatLayerName:Dt}=z(Ie),i=ge(()=>{let e=0,t=0,a={start:new Date,end:new Date};switch(Le.value){case B.spectral_distance_3d:e=3,t=4,ee.value&&(a=ee.value);break;case B.spectral_distance_5d:e=5,t=5,te.value&&(a=te.value);break;case B.spectral_distance_7d:e=7,t=6,ae.value&&(a=ae.value);break;case B.spectral_distance_11d:e=11,t=7,ne.value&&(a=ne.value);break}return{description:r("Raudsat "+e),value_range:[0,.15],color_range:[0,.15],visible_range:[0,.15],period:a,dimension:t,text:[r("Bad"),r("Similarity")+"\n"+r("Ocean color").toLowerCase()+"\n"+r("Good")],inverse:!0,colors:gt({colormap:"viridis",nshades:20,format:"rgbaString",alpha:.8})}}),F=vt("midnor");F.setSpaceStride(3);const{timeStride:se,spaceStride:xe,region:Q,boundingBox:S,activeLayer:Ft,activeLayerName:Ct,sinmod_info:v}=z(F),{data:Z}=yt(se,Q),{array:$}=ht(se,xe,Q,S),C=m(0),le=N(S),re=ge(()=>{var e;return((e=$.value)==null?void 0:e.length)>C.value&&$.value[C.value].isSuccess?$.value[C.value].data:[[0,0,.1,.1,.2,0,.1,-.1,"2025",1,1,1,1,1,1,1,1]]}),_=m(7),p=m(N(S)),O=m(N(S)),De=At();d(_,()=>{const e=_.value,t=a=>a>8.5||a<=8.5&&a>8?2:(a<=8&&a>7,3);if(_.value>8.5){const a=N(p),o=.2*(a.lng[1]-a.lng[0]),n=.2*(a.lat[1]-a.lat[0]);a.lat=[a.lat[0]-n,a.lat[1]+n],a.lng=[a.lng[0]-o,a.lng[1]+o],O.value=N(S),O.value.lng[0]-le.lng[0]>1e-5&&(console.log("Remove queries with bounds:",O.value),De.removeQueries({queryKey:["sinmod",N(Q),N(O)],exact:!1}))}else F.setBoundingBox(le);F.setSpaceStride(t(e))}),d(p,(e,t)=>{var a;try{(a=c.value)==null||a.setOption({dataset:{fromDatasetId:"sinmod-dataset",id:"sinmod-dataset-filtered",transform:{type:"filter",config:{and:[{dimension:"lng0",">":p.value.lng[0],"<":p.value.lng[1]},{dimension:"lat0",">":p.value.lat[0],"<":p.value.lat[1]}]}}}})}catch(o){}});const Fe=e=>{const t=new Array;return t.push({id:"raudsat-dataset",dimensions:[{type:"float",name:"lng"},{type:"float",name:"lat"},{type:"float",name:"half_width"},{type:"float",name:"half_height"},{type:"float",name:"spec_dist3"},{type:"float",name:"spec_dist5"},{type:"float",name:"spec_dist7"},{type:"float",name:"spec_dist11"}],source:{lng:new Float64Array(y).map(()=>NaN),lat:new Float64Array(y).map(()=>NaN),half_width:new Float64Array(y).map(()=>NaN),half_height:new Float64Array(y).map(()=>NaN),spec_dist3:new Float64Array(y).map(()=>NaN),spec_dist5:new Float64Array(y).map(()=>NaN),spec_dist7:new Float64Array(y).map(()=>NaN),spec_dist11:new Float64Array(y).map(()=>NaN)}}),t.push({id:"sinmod-dataset",dimensions:[{type:"float",name:"id"},{type:"float",name:"lng0"},{type:"float",name:"lat0"},{type:"float",name:"lng1"},{type:"float",name:"lat1"},{type:"float",name:"lng2"},{type:"float",name:"lat2"},{type:"float",name:"lng3"},{type:"float",name:"lat3"},{type:"time",name:"time"},{type:"float",name:"calanus_finmarchicus"},{type:"float",name:"diatoms"},{type:"float",name:"flagellates"},{type:"float",name:"temperature"},{type:"float",name:"salinity"},{type:"float",name:"u_east"},{type:"float",name:"v_north"},{type:"float",name:"current"}],source:{id:new Float64Array(l).map(()=>NaN),lng0:new Float64Array(l).map(()=>NaN),lat0:new Float64Array(l).map(()=>NaN),lng1:new Float64Array(l).map(()=>NaN),lat1:new Float64Array(l).map(()=>NaN),lng2:new Float64Array(l).map(()=>NaN),lat2:new Float64Array(l).map(()=>NaN),lng3:new Float64Array(l).map(()=>NaN),lat3:new Float64Array(l).map(()=>NaN),time:new Array(l).map(()=>""),calanus_finmarchicus:new Float64Array(l).map(()=>NaN),diatoms:new Float64Array(l).map(()=>NaN),flagellates:new Float64Array(l).map(()=>NaN),temperature:new Float64Array(l).map(()=>NaN),salinity:new Float64Array(l).map(()=>NaN),u_east:new Float64Array(l).map(()=>NaN),v_north:new Float64Array(l).map(()=>NaN),current:new Float64Array(l).map(()=>NaN)}}),t.push({fromDatasetId:"sinmod-dataset",id:"sinmod-dataset-filtered",transform:{type:"filter",config:{and:[{dimension:"lng0",">":p.value.lng[0],"<":p.value.lng[1]},{dimension:"lat0",">":p.value.lat[0],"<":p.value.lat[1]}]}}}),t},K=m(!0),ie=()=>{var e;try{(e=c.value)==null||e.setOption({visualMap:{id:"sinmod",text:v.value.text,show:!0,right:0,padding:8,top:172,itemWidth:24,itemHeight:80,handleSize:"140%",calculable:!0,realtime:!0,outOfRange:{color:["rgba(127,127,127,0.2)","rgba(127,127,127,0.2)"],colorAlpha:[0,0]},type:"continuous",seriesIndex:1,precision:2,inverse:!1,dimension:v.value.dimension,min:v.value.color_range[0],max:v.value.color_range[1],range:v.value.visible_range,inRange:{color:v.value.colors}}})}catch(t){}},de=()=>{var e;try{(e=c.value)==null||e.setOption({visualMap:{id:"raudsat",text:i.value.text,show:!0,right:0,padding:8,top:0,itemWidth:24,itemHeight:80,handleSize:"140%",calculable:!0,realtime:!0,outOfRange:{color:["rgba(127,127,127,0.2)","rgba(127,127,127,0.2)"],colorAlpha:[0,0]},type:"continuous",seriesIndex:0,dimension:i.value.dimension,precision:2,inverse:i.value.inverse,min:i.value.color_range[0],max:i.value.color_range[1],range:i.value.visible_range,inRange:{color:i.value.colors}}})}catch(t){}},ue=()=>{var t,a,o;const e=new Array;(t=Z.value)==null||t.timestrings.forEach((n,f)=>{var g;e.push({series:[{},{datasetId:"sinmod-dataset-"+Number(f).toString(10)}]}),(g=c.value)==null||g.setOption({dataset:{fromDatasetId:"sinmod-dataset-filtered",id:"sinmod-dataset-"+Number(f).toString(10),transform:{type:"filter",config:{dimension:"time","=":n,parser:"time"},print:!1}}})}),(o=c.value)==null||o.setOption({timeline:{data:(a=Z.value)==null?void 0:a.timestrings},options:e})},ce=()=>{var e;(e=c.value)==null||e.setOption({dataset:{id:"raudsat-dataset",source:oe.data.value}})},me=async()=>{var e;(e=c.value)==null||e.setOption({dataset:{id:"sinmod-dataset",source:re.value}})};d(v,()=>{ie()}),d(i,()=>{de()}),d(Z,()=>{ue()}),d(oe.data,()=>{ce()}),d(re,()=>{me()});const pe={backgroundColor:"rgba(255,255,255,0)",legend:{textStyle:{fontSize:14},top:1,borderWidth:1,borderRadius:2,left:"center",orient:"vertical",selectedMode:"single",show:!0,selected:{Raudsat:!1,"SINMOD - MIDNOR":!0}},timeline:{left:"5%",right:"5%",bottom:10,show:!0,axisType:"category",symbol:"roundRect",realtime:!0,loop:!0,autoPlay:!1,controlStyle:{showPlayBtn:!0,stopIcon:"image://data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAGpJREFUWAntlkEKwDAIBKP+/znt82xrD6FIpSSHXDpCQBeXDXOyNQoCBQEz21T1eL7QivUuj/qkO1MTwUm6R3cvPbEw6tO3kJUaH4AABCAAAQhAAAIQgEBJQET2fJxe2udZPuvLWcz/IXACuUMWMJDzUAgAAAAASUVORK5CYII=",playIcon:"path://M41.365908,29.4271388 L41.3664843,29.4265626 L26.3794329,19.1497136 L26.3747509,19.1541315 C26.0642269,18.8592621 25.6429678,18.677793 25.1786824,18.677793 C24.2236284,18.677793 23.4494433,19.4443188 23.4494433,20.3905371 C23.4494433,20.910214 23.4270417,21.9276946 23.4494433,21.9056292 L23.4494433,30.6673861 L23.4494433,39.8901629 C23.4494433,39.8977982 23.4494433,40.4825908 23.4494433,40.9444991 C23.4494433,41.8901412 24.2236284,42.656691 25.1786824,42.656691 C25.6447205,42.656691 26.0677564,42.4740454 26.3782564,42.1764869 L26.3794329,42.1770872 L41.3664843,31.9005503 L41.3659081,31.8996379 C41.6917266,31.5882735 41.894997,31.1514078 41.894997,30.6670739 C41.894997,30.6658974 41.894997,30.6650091 41.894997,30.6635444 C41.894997,30.6623679 41.894997,30.6609273 41.894997,30.6600389 C41.894997,30.175657 41.6917265,29.7384792 41.365908,29.4271388 Z"},symbolSize:15,playInterval:750,itemStyle:{borderWidth:2},emphasis:{label:{fontSize:14,fontWeight:"bolder"}},checkpointStyle:{symbol:"pin",symbolSize:16},lineStyle:{width:3},label:{align:"left",fontSize:14,fontWeight:"bold",padding:2,formatter:function(e,t){if(t%6==0){const a={month:"short",day:"numeric",timeZoneName:"short",hour:"numeric",minute:"numeric",hour12:!1};return new Intl.DateTimeFormat(h.value,a).format(new Date(U(e).toDate()))}else{if(t%6==1)return"";{const a={hour:"numeric",minute:"numeric",hour12:!1};return new Intl.DateTimeFormat(h.value,a).format(new Date(U(e).toDate()))}}}},tooltip:{textStyle:{fontSize:14},formatter:e=>new Intl.DateTimeFormat(h.value,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!1,timeZoneName:"short"}).format(new Date(U(e.name).toDate()))}},tooltip:{},toolbox:{itemSize:24,top:32,left:64,orient:"vertical",feature:{saveAsImage:{name:"raudfinn",backgroundColor:"rgba(255,255,255,1)",excludeComponents:["toolbox"],iconStyle:{borderColor:"#4170f0",borderWidth:2},emphasis:{iconStyle:{textFill:"rgba(0,0,0,1)",textBackgroundColor:"rgba(255,255,255,0.7)",textPadding:4}}}}},lmap:{attributionControl:!1,center:[7.5,65],zoom:7,minZoom:6,resizeEnable:!0,renderOnMoving:!1,echartsLayerInteractive:!0,largeMode:!1,zoomControl:!1,zoomSnap:.5,zoomDelta:.5,zoomAnimation:!1,fadeAnimation:!1,wheelPxPerZoomLevel:120},dataset:Fe(),visualMap:[{id:"raudsat"},{id:"sinmod"}],series:[{type:"custom",coordinateSystem:"lmap",name:"Raudsat",id:"raud",renderItem:$e(i),tooltip:{position:(e,t,a,o,n)=>({bottom:60,left:20}),formatter:e=>{var a,o;let t="";if(e.value&&e.dimensionNames){const n=e.value,f=n[1],g=n[0],R=n[1]+2*n[3],T=n[0]+2*n[2],V=(a=s.value)==null?void 0:a.distance(u.latLng(f,g),u.latLng(R,g)),q=(o=s.value)==null?void 0:o.distance(u.latLng(f,g),u.latLng(f,T)),I=i.value.dimension,k=new Intl.DateTimeFormat(h.value,{year:"numeric",month:"short",day:"numeric"}).format(i.value.period.start),H=new Intl.DateTimeFormat(h.value,{year:"numeric",month:"short",day:"numeric"}).format(i.value.period.end);return t+='<table class="raudfinn-item">',t+='<tr><th colspan=2 align="center">'+e.marker+" "+i.value.description+"</th></tr>",t+="<tr><td><b>"+r(e.dimensionNames[I])+'</b></td><td align="right">'+n[I].toFixed(2)+"</td></tr>",t+="<tr><td><b>"+r("Timeperiod")+'</b></td><td align="right">'+k+" - "+H+"</td></tr>",t+="<tr><td><b>"+r("Position")+'</b></td><td align="right">'+E({lng:g,lat:f}).format(L.value)+"</td></tr>",t+="<tr><td><b>"+r("Resolution")+' (lat x lon)</b></td><td align="right">'+V.toFixed(0)+" x "+q.toFixed(0)+" m</td></tr>",t+="</table>",t}else return""}},datasetId:"raudsat-dataset",progressive:1e4,progressiveChunkMode:"sequential",animation:!1},{type:"custom",coordinateSystem:"lmap",name:"SINMOD - MIDNOR",id:"midnor",renderItem:Ke(v),tooltip:{position:(e,t,a,o,n)=>({bottom:60,left:20}),formatter:e=>{var t,a;if(e.value&&e.dimensionNames){let o="";const n=e.value,f=n[2],g=n[1],R=n[4],T=n[3],V=n[6],q=n[5],I=n[8],k=n[7],H=.25*(f+R+V+I),Ee=.25*(g+T+q+k),ze=(t=s.value)==null?void 0:t.distance(u.latLng(f,g),u.latLng(R,T)),Pe=(a=s.value)==null?void 0:a.distance(u.latLng(f,g),u.latLng(I,k)),Be=.5*(ze+Pe),Ue=new Intl.DateTimeFormat(h.value,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!1,timeZoneName:"short"}).format(U(n[9]).toDate());return o+='<table class="raudfinn-item">',o+='<tr><th colspan=3 align="center">'+e.marker+" "+v.value.description+"</th></tr>",o+="<tr><td><b>"+r("Timepoint")+'</b></td><td colspan=2 align="right">'+Ue+"</td></tr>",o+="<tr><td><b>"+r("Position")+'</b></td><td colspan=2 align="right">'+E({lng:Ee,lat:H}).format(L.value)+"</td></tr>",o+="<tr><td><b>"+r("Resolution")+'</b></td><td align="right">'+Be.toFixed(0)+"</td><td>m</td></tr>",o+='<tr><td colspan=3 class="raudfinn-item-td"></td></tr>',Object.values(wt).forEach(J=>{e.dimensionNames&&(o+="<tr><td><b>"+r(e.dimensionNames[J.dimension])+'</b></td><td align="right">'+n[J.dimension].toFixed(2)+"</td><td>"+J.unit+"</td></tr>")}),o+="</table>",o}else return""}},datasetId:"sinmod-dataset",progressive:1e4,progressiveChunkMode:"sequential",animation:!1}]},Ce=()=>{var e;(e=c.value)==null||e.setOption(pe),de(),ie(),ue()},Oe=()=>{ce(),me()},w=m(!0);d(Y,()=>{w.value=!0,M()}),d(G,()=>{w.value=!0,M()}),d(c,(e,t)=>{w.value=!0,M()}),d(s,(e,t)=>{Oe()});const M=()=>{setTimeout(()=>{if(w.value&&(w.value=!Ve(_e,s,c,Se),Ce()),s.value)try{s.value.invalidateSize(),D.value.addTo(s.value),_.value=s.value.getZoom(),s.value.on("moveend",e=>{const t=s.value.getBounds(),a=t.getEast()-t.getWest(),o=t.getNorth()-t.getSouth(),n=.05;p.value={lng:[t.getWest()-n*a,t.getEast()+n*a],lat:[t.getSouth()-n*o,t.getNorth()+n*o]}}),s.value.on("zoomend",e=>{_.value=s.value.getZoom()})}catch(e){console.warn("Map does not exist yet")}},50)},Me=e=>{K.value!=e.selected["SINMOD - MIDNOR"]&&(K.value=e.selected["SINMOD - MIDNOR"])},Re=e=>{var t;e.playState&&!K.value&&(we(r("SINMOD disabled")),(t=c.value)==null||t.dispatchAction({type:"timelinePlayChange",playState:!1}))},Te=e=>{C.value=e.currentIndex},ke=e=>{e.visualMapId==="sinmod"?v.value.value_range=e.selected:e.visualMapId==="raudsat"&&(i.value.value_range=e.selected)};return ve({doPlot:M}),(e,t)=>(St(),Nt(bt(Ze),{ref_key:"theChart",ref:c,class:"chart","manual-update":!0,autoresize:!0,option:pe,onDatarangeselected:ke,onLegendselectchanged:Me,onTimelineplaychanged:Re,onTimelinechanged:Te},null,512))}}),kt=It(Lt,[["__scopeId","data-v-b02025f6"]]);export{kt as R};
